version: "3.9"

services:
  neo4j:
    image: neo4j:5.22.0-community
    container_name: monitor-neo4j
    restart: unless-stopped

    env_file:
      - .env

    environment:
      # Auth
      NEO4J_AUTH: "${NEO4J_USERNAME:-neo4j}/${NEO4J_PASSWORD:-monitor_dev_password}"

      # Memory settings (tunable)
      NEO4J_server_memory_pagecache_size: "${NEO4J_PAGECACHE:-1G}"
      NEO4J_server_memory_heap_initial__size: "${NEO4J_HEAP_INITIAL:-512m}"
      NEO4J_server_memory_heap_max__size: "${NEO4J_HEAP_MAX:-512m}"

      # Timezone (good for deterministic tests/logs)
      NEO4J_db_temporal_timezone: "UTC"

      # APOC plugin (handy later for utilities, not mandatory now)
      NEO4J_PLUGINS: '["apoc"]'

    ports:
      - "${NEO4J_HTTP_PORT:-7474}:7474"  # Browser / HTTP
      - "${NEO4J_BOLT_PORT:-7687}:7687"  # Bolt

    volumes:
      - ./data:/data
      - ./logs:/logs
      - ./plugins:/plugins
      - ./conf:/conf
